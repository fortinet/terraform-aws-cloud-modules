## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3, < 2.0.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | n/a |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_associate_spk_to_tgwrt"></a> [associate\_spk\_to\_tgwrt](#module\_associate\_spk\_to\_tgwrt) | ../../modules/aws/tgw_route_table | n/a |
| <a name="module_fgt_asg"></a> [fgt\_asg](#module\_fgt\_asg) | ../../modules/fortigate/fgt_asg | n/a |
| <a name="module_propagate_spk_to_tgwrt"></a> [propagate\_spk\_to\_tgwrt](#module\_propagate\_spk\_to\_tgwrt) | ../../modules/aws/tgw_route_table | n/a |
| <a name="module_security-vpc"></a> [security-vpc](#module\_security-vpc) | ../../modules/aws/vpc | n/a |
| <a name="module_security-vpc-gwlb"></a> [security-vpc-gwlb](#module\_security-vpc-gwlb) | ../../modules/aws/gwlb | n/a |
| <a name="module_security_route_table"></a> [security\_route\_table](#module\_security\_route\_table) | ../../modules/aws/vpc_route_table | n/a |
| <a name="module_spkvpc-rt"></a> [spkvpc-rt](#module\_spkvpc-rt) | ../../modules/aws/vpc_route_table | n/a |
| <a name="module_spoke_vpc_tgw_attachment"></a> [spoke\_vpc\_tgw\_attachment](#module\_spoke\_vpc\_tgw\_attachment) | ../../modules/aws/tgw | n/a |
| <a name="module_tgw_rt_secvpc"></a> [tgw\_rt\_secvpc](#module\_tgw\_rt\_secvpc) | ../../modules/aws/tgw_route_table | n/a |
| <a name="module_tgw_rt_spokevpc"></a> [tgw\_rt\_spokevpc](#module\_tgw\_rt\_spokevpc) | ../../modules/aws/tgw_route_table | n/a |
| <a name="module_transit-gw"></a> [transit-gw](#module\_transit-gw) | ../../modules/aws/tgw | n/a |

## Resources

| Name | Type |
|------|------|
| [aws_cloudwatch_metric_alarm.hybrid_asg](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_metric_alarm) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_access_key"></a> [access\_key](#input\_access\_key) | The Access Key of AWS account. | `string` | n/a | yes |
| <a name="input_asgs"></a> [asgs](#input\_asgs) | Auto Scaling group map.<br>Format:<pre>asgs = {<br>      \<ASG NAME\> = {<br>          \<Option\> = \<Option value\><br>      }<br>  }</pre>Options:<br>  FortiGate instance template<br>  - template\_name : (Optional\|string) Instance template name.<br>  - fgt\_version : (Required\|string) FortiGate version for the FortiGate instances. If the whole version been provided, please make sure the version is exist. If part of version been provided, such as 7.2, will using the latest release of this version.<br>  - instance\_type : (Optional\|string) Instance type for the FortiGate instances. Default is c5.xlarge.<br>  - license\_type : (Optional\|string) License type for the FortiGate instances. Options: on\_demand, byol. Default is on\_demand.<br>  - fgt\_hostname : (Optional\|string) FortiGate instance hostname.<br>  - fgt\_password : (Required\|string) FortiGate instance login password. This is required for BYOL type of FortiGate instance since we need to upload the license to the instance by lambda function.<br>  - fgt\_multi\_vdom : (Optional\|bool) Flag of FortiGate instance vdom type. `true` will be multi-vdom mode. `false` will be single-vdom mode. Default is `false`.<br>  - lic\_folder\_path : (Optional\|string) Folder path of FortiGate license files.<br>  - lic\_s3\_name : (Optional\|string) AWS S3 bucket name that contains FortiGate license files or token json file.<br>  - fortiflex\_refresh\_token : (Optional\|string) Refresh token used for FortiFlex.<br>  - fortiflex\_sn\_list : (Optional\|list) Serial number list from FortiFlex account that used to activate FortiGate instance.<br>  - fortiflex\_configid\_list : (Optional\|list) Config ID list from FortiFlex account that used to activate FortiGate instance.<br>  - keypair\_name : (Required\|string) The keypair name for accessing the FortiGate instances.<br>  - enable\_fgt\_system\_autoscale : (Optional\|bool) If true, FotiGate system auto-scale will be set.<br>  - fgt\_system\_autoscale\_psksecret : (Optional\|string) FotiGate system auto-scale psksecret.<br>  - fgt\_login\_port\_number : (Optional\|string) The port number for the FortiGate instance. Should set this parameter if the port number for FortiGate instance login is not 443.<br>  - user\_conf\_content : (Optional\|string) User configuration in CLI format that will applied to the FortiGate instance.<br>      The module do not cover the firewall policy generation. So, user should configure the firewall policy by this argumet.<br>      FortiGate instance port name format:<br>        1. For FortiGate port, the name should be 'port'+(device\_index + 1). For example, if the device\_index is 0, the the port name will be 'port1'.<br>        2. For interface tunnel with GENEVE protocol (used for connecting with GWLB target group), the name will be 'geneve-az<NUMBER>'. Check 'az\_name\_map' of the output of template, which is map of Geneve tunnel name to the AZ name that supported in Security VPC.<br>  - user\_conf\_file\_path : (Optional\|string) User configuration file path that will applied to FortiGate instance.<br>  - user\_conf\_s3 : (Optional\|map(list(string))) User configuration files in AWS S3 that will applied to FortiGate instance.<br>      The key is the Bucket name, and the value is a list of key names in this Bucket.<br>  - intf\_security\_group : (Required\|string) Security group map for FortiGate instance instances.<br>    Options:<br>      - login\_port : (Required\|string) Security group name for the login port of FortiGate instance.<br>      - internal\_port : (Required\|string) Security group name for the internal traffic port of FortiGate instance.<br>  Auto Scale Group<br>  - asg\_max\_size : (Required\|number) Maximum size of the Auto Scaling Group.<br>  - asg\_min\_size : (Required\|number) Minimum size of the Auto Scaling Group.<br>  - asg\_desired\_capacity : (Optional\|number) Number of Amazon EC2 instances that should be running in the group.<br>  - create\_dynamodb\_table : (Optional\|bool) If true, will create the DynamoDB table using dynamodb\_table\_name as the name. Default is false.<br>  - dynamodb\_table\_name : (Required\|string) DynamoDB table name that used for tracking Auto Scale Group information, such as instance information and primary IP.<br>  - scale\_policies : (Optional\|map) Auto Scaling group scale policies.<br>    Key is policy name. Options for values of parameter scale\_policies:<br>      - policy\_type               : (Required\|string) Policy type, either "SimpleScaling", "StepScaling", "TargetTrackingScaling", or "PredictiveScaling".<br>      - adjustment\_type           : (Optional\|string) Whether the adjustment is an absolute number or a percentage of the current capacity. Valid values are ChangeInCapacity, ExactCapacity, and PercentChangeInCapacity.<br>      Options only for SimpleScaling:<br>      - cooldown           : (Optional\|number) Amount of time, in seconds, after a scaling activity completes and before the next scaling activity can start.<br>      - scaling\_adjustment : (Optional\|string) Number of instances by which to scale. adjustment\_type determines the interpretation of this number (e.g., as an absolute number or as a percentage of the existing Auto Scaling group size). A positive increment adds to the current capacity and a negative value removes from the current capacity.<br>      Options only for TargetTrackingScaling:<br>      - target\_tracking\_configuration : (Optional\|map) Target tracking policy.<br>        Options for parameter target\_tracking\_configuration:<br>        - target\_value                    : (Required\|number) Target value for the metric.<br>        - disable\_scale\_in                : (Optional\|bool) Whether scale in by the target tracking policy is disabled. Default: false.<br>        - estimated\_instance\_warmup : (Optional\|number) Estimated time, in seconds, until a newly launched instance will contribute CloudWatch metrics.<br>        - predefined\_metric\_specification : (Optional\|map) Predefined metric.<br>          Options for parameter predefined\_metric\_specification:<br>          - predefined\_metric\_type : (Required\|string) Metric type.<br>          - resource\_label         : (Optional\|string) Identifies the resource associated with the metric type.<br><br>Example:<pre>asgs = {<br>  fgt_byol_asg = {<br>      template_name = "fgt_asg_template"<br>      fgt_version = "7.2"<br>      license_type = "byol"<br>      fgt_password = "ftnt"<br>      keypair_name = "keypair1"<br>      intf_security_group = {<br>        login_port    = "secgrp1"<br>        internal_port = "secgrp1"<br>      }<br>      asg_max_size = 3<br>      asg_min_size = 1<br>      scale_policies = {<br>        cpu_above_80 = {<br>            policy_type               = "TargetTrackingScaling"<br>            estimated_instance_warmup = 60<br>            target_tracking_configuration = {<br>              target_value = 80<br>              predefined_metric_specification = {<br>                predefined_metric_type = "ASGAverageCPUUtilization"<br>              }<br>            }<br>        }<br>      }<br>  }<br>}</pre> | `any` | n/a | yes |
| <a name="input_availability_zones"></a> [availability\_zones](#input\_availability\_zones) | Availability Zones | `list(string)` | n/a | yes |
| <a name="input_cloudwatch_alarms"></a> [cloudwatch\_alarms](#input\_cloudwatch\_alarms) | Cloudwatch Alarm configuration.<br>Format:<pre>cloudwatch_alarms = {<br>    \<Cloudwatch Alarm name\> = {<br>        \<Option name\> = \<Option value\><br>    }<br>  }</pre>Cloudwatch Alarm options:<br>  - comparison\_operator     : (Optional\|string) The arithmetic operation to use when comparing the specified Statistic and Threshold. The specified Statistic value is used as the first operand. Either of the following is supported: GreaterThanOrEqualToThreshold, GreaterThanThreshold, LessThanThreshold, LessThanOrEqualToThreshold. Additionally, the values LessThanLowerOrGreaterThanUpperThreshold, LessThanLowerThreshold, and GreaterThanUpperThreshold are used only for alarms based on anomaly detection models.<br>  - evaluation\_periods      : (Optional\|number) The number of periods over which data is compared to the specified threshold.<br>  - metric\_name             : (Optional\|string) The name for the alarm's associated metric.<br>  - namespace               : (Optional\|string) The namespace for the alarm's associated metric.<br>  - period                  : (Optional\|number) The period in seconds over which the specified statistic is applied. Valid values are 10, 30, or any multiple of 60.<br>  - statistic               : (Optional\|string) The statistic to apply to the alarm's associated metric. Either of the following is supported: SampleCount, Average, Sum, Minimum, Maximum.<br>  - threshold               : (Optional\|list) The value against which the specified statistic is compared. This parameter is required for alarms based on static thresholds, but should not be used for alarms based on anomaly detection models.<br>  - dimensions              : (Optional\|map) The dimensions for the alarm's associated metric.<br>  - alarm\_description       : (Optional\|string) The description for the alarm.<br>  - datapoints\_to\_alarm     : (Optional\|number) The number of datapoints that must be breaching to trigger the alarm.<br>  - alarm\_asg\_policies      : (Optional\|map) Information of auto-scale policies to execute when this alarm transitions into an ALARM state from any other state.<br>    Options for variable alarm\_asg\_policies:<br>    - policy\_arn\_list      : (Optional\|list) The list of auto-scale policy ARNs.<br>    - policy\_name\_map      : (Optional\|map) The map of Auto Scale Group name to the list of auto-scale policies under the ASG. The ASG must be handled by this template, and the template will grab the policy ARN based on the policy name.<br><br>Example:<pre>cloudwatch_alarms = {<br>  cpu_above_80 = {<br>    comparison_operator = "GreaterThanOrEqualToThreshold"<br>    evaluation_periods  = 2<br>    metric_name         = "CPUUtilization"<br>    namespace           = "AWS/EC2"<br>    period              = 120<br>    statistic           = "Average"<br>    threshold           = 80<br>    dimensions = {<br>      AutoScalingGroupName = "fgt_asg_byol"<br>    }<br>    alarm_description = "This metric monitors average ec2 cpu utilization of Auto Scale group fgt_asg_byol."<br>    datapoints_to_alarm = 1<br>    alarm_asg_policies     = ["cpu_above_80"]<br>  }<br>}</pre> | `any` | `{}` | no |
| <a name="input_enable_cross_zone_load_balancing"></a> [enable\_cross\_zone\_load\_balancing](#input\_enable\_cross\_zone\_load\_balancing) | If true, cross-zone load balancing of the load balancer will be enabled. | `bool` | `null` | no |
| <a name="input_enable_east_west_inspection"></a> [enable\_east\_west\_inspection](#input\_enable\_east\_west\_inspection) | If true, east-west security inspection will be enabled. | `bool` | `true` | no |
| <a name="input_existing_security_vpc"></a> [existing\_security\_vpc](#input\_existing\_security\_vpc) | Using existing VPC. <br>If the id is specified, will use this VPC ID. Otherwise, will search the VPC based on the given infomation.<br>Options:<br>    - cidr\_block :  Cidr block of the desired VPC.<br>    - id         :  ID of the specific VPC.<br>    - name       :  Name of the specific VPC to retrieve.<br>    - tags       :  Map of tags, each pair of which must exactly match a pair on the desired VPC.<br>    <br>Example:<pre>existing_security_vpc = {<br>    name = "Security_VPC"<br>    tags = {<br>        \<Option\> = \<Option value\><br>    }<br>}</pre> | `any` | `null` | no |
| <a name="input_existing_tgw"></a> [existing\_tgw](#input\_existing\_tgw) | Using existing Transit gateway. <br>If the id is specified, will use this Transit gateway ID. Otherwise, will search the Transit gateway based on the given infomation.<br>Options:<br>    - id         :  ID of the specific Transit gateway.<br>    - filter     :  Map of the filters. Value should be a list.   <br>Example:<pre>existing_tgw = {<br>    filter = {<br>        "options.amazon-side-asn" = ["64512"]<br>    }<br>}</pre> | `any` | `null` | no |
| <a name="input_fgt_intf_mode"></a> [fgt\_intf\_mode](#input\_fgt\_intf\_mode) | FortiGate interface design. There are two options: <br>  1-arm: only one port in FortiGate for both internet (including login/mgmt) and internal traffic (including Geneve tunnel); <br>  2-arm: two ports in FortiGate, one for internet (including login/mgmt), another one for internal traffic (including Geneve tunnel); | `string` | `"2-arm"` | no |
| <a name="input_general_tags"></a> [general\_tags](#input\_general\_tags) | The tags that will apply to all resouces. | `map(string)` | n/a | yes |
| <a name="input_gwlb_name"></a> [gwlb\_name](#input\_gwlb\_name) | Gateway Load Balancer name. | `string` | `"gwlb-fgt"` | no |
| <a name="input_igw_name"></a> [igw\_name](#input\_igw\_name) | Internet Gateway name for the security VPC. | `string` | `"security-vpc-igw"` | no |
| <a name="input_region"></a> [region](#input\_region) | The region to deploy the VPC. | `string` | n/a | yes |
| <a name="input_secret_key"></a> [secret\_key](#input\_secret\_key) | The Secret Key of AWS account. | `string` | n/a | yes |
| <a name="input_security_groups"></a> [security\_groups](#input\_security\_groups) | Security groups configuration for the target VPC.<br>Format:<pre>security_groups = {<br>        \<Security group name\> = {<br>            description = "\<Description\>"<br>            ingress     = {<br>                \<Rule name1\> = {<br>                    \<Option\> = \<Option value\><br>                }<br>            }<br>            egress     = {<br>                \<Rule name1\> = {<br>                    \<Option\> = \<Option value\><br>                }<br>            }<br>        }<br>    }</pre>Security groups options:<br>    - description  : (Optional\|string) Security group description. Cannot be empty string(""), and also can not be updated after created. This field maps to the AWS `GroupDescription` attribute, for which there is no Update API. If you'd like to classify your security groups in a way that can be updated, use `tags`.<br>    - ingress      : (Optional\|map) Configuration block for ingress rules.<br>    - egress       : (Optional\|map) Configuration block for egress rules.<br><br>Ingress options:<br>    - from\_port         : (Required\|string) Start port (or ICMP type number if protocol is icmp or icmpv6).<br>    - to\_port           : (Required\|string) End range port (or ICMP code if protocol is icmp).<br>    - protocol          : (Required\|string) Protocol.<br>    - cidr\_blocks       : (Optional\|list)  List of CIDR blocks.<br>    - description       : (Optional\|string) Description of this ingress rule.<br>    - ipv6\_cidr\_blocks  : (Optional\|list) List of IPv6 CIDR blocks.<br>    - prefix\_list\_ids   : (Optional\|list) List of Prefix List IDs.<br>    - security\_groups   : (Optional\|list) List of security groups. A group name can be used relative to the default VPC. Otherwise, group ID.<br><br>Egress options:<br>    - from\_port         : (Required\|string) Start port (or ICMP type number if protocol is icmp).<br>    - to\_port           : (Required\|string) End range port (or ICMP code if protocol is icmp).<br>    - protocol          : (Required\|string) Protocol.<br>    - cidr\_blocks       : (Optional\|list)  List of CIDR blocks.<br>    - description       : (Optional\|string) Description of this egress rule.<br>    - ipv6\_cidr\_blocks  : (Optional\|list) List of IPv6 CIDR blocks.<br>    - prefix\_list\_ids   : (Optional\|list) List of Prefix List IDs.<br>    - security\_groups   : (Optional\|list) List of security groups. A group name can be used relative to the default VPC. Otherwise, group ID.<br><br>Example:<pre>security_groups = {<br>    secgrp1 = {<br>        description = "Security group by Terraform"<br>        ingress     = {<br>            https = {<br>                from_port         = "443"<br>                to_port           = "443"<br>                protocol          = "tcp"<br>                cidr_blocks       = [ "0.0.0.0/0" ]<br>            }<br>        }<br>        egress     = {<br>            all_traffic = {<br>                from_port         = "0"<br>                to_port           = "0"<br>                protocol          = "tcp"<br>                cidr_blocks       = [ "0.0.0.0/0" ]<br>            }<br>        }<br>    }<br>}</pre> | `any` | `{}` | no |
| <a name="input_security_vpc_tgw_attachments"></a> [security\_vpc\_tgw\_attachments](#input\_security\_vpc\_tgw\_attachments) | Transit gateway VPC attachments configuration for the Transit gateway. <br>Format:<pre>security_vpc_tgw_attachments = {<br>        \<Option\> = \<Option value\><br>    }</pre>Options:<br>    - appliance\_mode\_support                          : (Optional\|string) Whether Appliance Mode support is enabled. If enabled, a traffic flow between a source and destination uses the same Availability Zone for the VPC attachment for the lifetime of that flow. Valid values: disable, enable. Default value: enable.<br>    - dns\_support                                     : (Optional\|string) Whether DNS support is enabled. Valid values: disable, enable. Default value: enable.<br>    - ipv6\_support                                    : (Optional\|string) Whether IPv6 support is enabled. Valid values: disable, enable. Default value: disable.<br>    - transit\_gateway\_default\_route\_table\_association : (Optional\|bool) Boolean whether the VPC Attachment should be associated with the EC2 Transit Gateway association default route table. This cannot be configured or perform drift detection with Resource Access Manager shared EC2 Transit Gateways. Default value: true.<br>    - transit\_gateway\_default\_route\_table\_propagation : (Optional\|bool) Boolean whether the VPC Attachment should propagate routes with the EC2 Transit Gateway propagation default route table. This cannot be configured or perform drift detection with Resource Access Manager shared EC2 Transit Gateways. Default value: true.<br><br>Example:<pre>security_vpc_tgw_attachments = {<br>    appliance_mode_support = "enable"<br>}</pre> | `any` | `{}` | no |
| <a name="input_spk_vpc"></a> [spk\_vpc](#input\_spk\_vpc) | Spoke VPC configuration. VPC ID and Subnet IDs shold be provided. This module will create Transit Gateway Attachments under each subnet, and create VPC route tables with the subnet associated.<br>Format:<pre>spk_vpc = {<br>        \<Spoke VPC name\> = {<br>            vpc_id = "\<VPC_ID\>"<br>            subnet_ids     = [<br>              "SUBNET_ID"<br>            ]<br>        }<br>    }</pre>Spoke VPC options:<br>    - vpc\_id     : (Optional\|string) Spoke VPC ID.<br>    - subnet\_ids : (Optional\|list) Subnet ID list. Note: Subnets that TGW will attach to should not already have a route table association.<br>    - route\_table\_name : (Optional\|string) Route table name for the traffic to Transit Gateway Attachment. Default is "spkvpc-to-tgwa-<Spoke VPC name>".<br>Example:<pre>spk_vpc = {<br>  "spk_vpc1" = {<br>    vpc_id = "vpc-123456789",<br>    subnet_ids = [<br>      "subnet-123456789",<br>      "subnet-123456789"<br>    ]<br>  }<br>}</pre> | `any` | `{}` | no |
| <a name="input_spoke_cidr_list"></a> [spoke\_cidr\_list](#input\_spoke\_cidr\_list) | The IPv4 CIDR block list for the spoke VPCs. | `list(string)` | n/a | yes |
| <a name="input_subnets"></a> [subnets](#input\_subnets) | Subnets configuration for the target VPC.<br>Format:<pre>subnets = {<br>        \<Subnet name\> = {<br>            \<Option\> = \<Option value\><br>        }<br>    }</pre>Subnet options:<br>    - cidr\_block  : (Optional\|string) The IPv4 CIDR block for the subnet.<br>    - availability\_zone  : (Optional\|string) AZ for the subnet.<br>    - map\_public\_ip\_on\_launch  : (Optional\|string) Specify true to indicate that instances launched into the subnet should be assigned a public IP address. Default is false.<br>Example:<pre>subnets = {<br>    fgt_asg = {<br>        cidr_block = "10.0.1.0/24"<br>        availability_zone = "us-west-2a"<br>    }<br>}</pre> | `any` | `{}` | no |
| <a name="input_tgp_name"></a> [tgp\_name](#input\_tgp\_name) | Target Group name. | `string` | `"gwlb-tgp-fgt"` | no |
| <a name="input_tgw_description"></a> [tgw\_description](#input\_tgw\_description) | Description of the EC2 Transit Gateway. | `string` | `""` | no |
| <a name="input_tgw_name"></a> [tgw\_name](#input\_tgw\_name) | Transit gateway name | `string` | n/a | yes |
| <a name="input_vpc_cidr_block"></a> [vpc\_cidr\_block](#input\_vpc\_cidr\_block) | The IPv4 CIDR block for the VPC. | `string` | n/a | yes |
| <a name="input_vpc_name"></a> [vpc\_name](#input\_vpc\_name) | VPC name for the security VPC. | `string` | `"security-vpc"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_az_name_map"></a> [az\_name\_map](#output\_az\_name\_map) | n/a |
| <a name="output_gwlb_ips"></a> [gwlb\_ips](#output\_gwlb\_ips) | n/a |
| <a name="output_route_tables"></a> [route\_tables](#output\_route\_tables) | n/a |
| <a name="output_secvpc-output"></a> [secvpc-output](#output\_secvpc-output) | n/a |
| <a name="output_subnets"></a> [subnets](#output\_subnets) | n/a |
